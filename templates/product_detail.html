{% extends 'base.html' %}
{% load static %}

{% block content %}

<section class="section-content padding-y bg">
	<div class="container">
		<!-- ============================ COMPONENT 1 ================================= -->

		<div class="card">
			<div class="row no-gutters">
				<aside class="col-md-6">
					<article class="gallery-wrap">
						<div class="img-big-wrap">
							<a href="#"><img src="{{single_product.product_image.url }}"></a>
						</div> <!-- img-big-wrap.// -->

					</article> <!-- gallery-wrap .end// -->
				</aside>
				<main class="col-md-6 border-left">
					<article class="content-body">
						<div class="d-flex justify-content-between">
						<h2 class="title">{{single_product.product_name}}</h2>
						{% if wishlist %}
						<a href="{% url 'remove_from_wishlist' single_product.id %}" class="widget-header pl-3 ml-3">
							<i class="text-danger fas fa-heart fa-2x " aria-hidden="true"></i>
						</a>
						{% else %}
						<a href="{% url 'add_to_wishlist' single_product.id %}" class="widget-header pl-3 ml-3">
							<i class="far fa-heart fa-2x" aria-hidden="true"></i>
						</a>
						{% endif %}
						</div>
						<div class="mb-1">
							<span class="fa fa-star {% if single_product.average_rating.rating__avg > 0 %} checked {% endif %}"></span>
							<span class="fa fa-star {% if single_product.average_rating.rating__avg > 1 %} checked {% endif %}"></span>
							<span class="fa fa-star {% if single_product.average_rating.rating__avg > 2 %} checked {% endif %}"></span>
							<span class="fa fa-star {% if single_product.average_rating.rating__avg > 3 %} checked {% endif %}" ></span>
							<span class="fa fa-star {% if single_product.average_rating.rating__avg > 4 %} checked {% endif %}"></span>
							<span class="ml-2">{{single_product.review_count.id__count}} Reviews</span>
						</div>
						<div class="mb-3">
							<var class="price h4">${{single_product.price|floatformat:2}}</var>
						</div>
						<!-- <hr> -->

						<div style="line-height: 30px;">
							<p>{{single_product.description|linebreaks}}</p>
						</div>

						<hr>
						{% if single_product.stock <= 0 %}
						<button class="btn btn-warning border-dark"><span class="text">Out of Stock</span></button>
						{% else %}
							{% if in_cart %}
							<button class="btn btn-success border-dark"><span class="text">Added to Cart</span><i class="fas fa-check"></i></button>
							<a href="{% url 'cart_home' %}" class="btn  btn-dark addtocart"> <span class="text">View Cart</span> <i class="fas fa-eye"></i> </a>
							{% else %}
						<p class="text-danger font-weight-bold">In Stock</p>
						<a href="{% url 'add_to_cart' single_product.id %}" class="btn  btn-dark addtocart"> <span class="text">Add to
								Cart</span> <i class="fas fa-shopping-cart"></i> </a>
							{% endif %}
						{% endif %}
					</article> <!-- product-info-aside .// -->
				</main> <!-- col.// -->
			</div> <!-- row.// -->
		</div> <!-- card.// -->
		<!-- ============================ COMPONENT 1 END .// ================================= -->

		<br>

		<div class="row">
			<div class="col-md-9">

				{% if messages %}
                    {% for message in messages %}
                        {% if message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}
                            <div class="alert alert-success alert-dismissible">
                                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                                <strong>{{message}}</strong>
                            </div>
                        {% endif%}
                    {% endfor %}
                {% endif %}
		

				<form action="{% url 'product_review' single_product.id %}" method="post">
					{% csrf_token %}
					<h5>Write Your Review</h5>
					<label>Rating :</label>
					<div class="form-group">
						<div class="rating">
							<input type="radio" id="rating5" name="rating" value="5" required><label for="rating5" class="fas fa-star" title="5"></label>
							<input type="radio" id="rating4" name="rating" value="4" required><label for="rating4" class="fas fa-star" title="4"></label>
							<input type="radio" id="rating3" name="rating" value="3" required><label for="rating3" class="fas fa-star" title="3"></label>
							<input type="radio" id="rating2" name="rating" value="2" required><label for="rating2" class="fas fa-star" title="2"></label>
							<input type="radio" id="rating1" name="rating" value="1" required><label for="rating1" class="fas fa-star" title="1"></label>
						</div>
					<br>
						<label>Review :</label>
						<textarea name="review" rows="4" class="form-control"></textarea>
						<br>
						{% if request.user.is_authenticated %}
							{% if order_product %}
								<input type="submit" value="Submit Review" class="btn btn-info">
							{% else %}
								<strong class="text-warning">Please purchase this product for submitting review.</strong>
							{% endif %}
						{% else %}
							<strong>You are not logged in, please <a href="{% url 'login' %}">Login</a> to submit review.</strong>
						{% endif %}
					</div>			
				</form>
	
				<header class="section-heading {% if reviews %} d-flex justify-content-between {% endif %}">
					<h3>Customer Reviews </h3>
				{% if reviews %}
					<h5 class="card-title">Avg rating:
						<span class="fa fa-star {% if single_product.average_rating.rating__avg > 0 %} checked {% endif %}"></span>
						<span class="fa fa-star {% if single_product.average_rating.rating__avg > 1 %} checked {% endif %}"></span>
						<span class="fa fa-star {% if single_product.average_rating.rating__avg > 2 %} checked {% endif %}"></span>
						<span class="fa fa-star {% if single_product.average_rating.rating__avg > 3 %} checked {% endif %}" ></span>
						<span class="fa fa-star {% if single_product.average_rating.rating__avg > 4 %} checked {% endif %}"></span>

					</h5>	
				</header>

					{% for review in reviews %}
				<article class="box mb-3">
					<div class="icontext w-100">
						<img src="{{review.user.p_user.profile_pic.url}}" class="img-xs icon rounded-circle">
						<div class="text">
							<span class="date text-muted float-md-right">{{review.updated_at}} </span>
							<h6 class="mb-1">{{review.user.first_name|capfirst}} {{review.user.last_name|capfirst}}</h6>		
									<span class="fa fa-star{% if review.rating >= 1 %} checked {% endif %}"></span>
									<span class="fa fa-star{% if review.rating >= 2 %} checked {% endif %}"></span>
									<span class="fa fa-star{% if review.rating >= 3 %} checked {% endif %}" ></span>
									<span class="fa fa-star{% if review.rating >= 4 %} checked {% endif %}"></span>
									<span class="fa fa-star{% if review.rating >= 5 %} checked {% endif %}"></span>
						</div>
					</div> <!-- icontext.// --> 
					<div class="mt-3">
						<p>
							{{review.review}}
						</p>
					</div>
				</article>
					{% endfor %}
				{% else %}
				<div class="mt-3">
					<h6>
						No reviews posted yet !
					</h6>
				</div>
				{% endif %}



			</div> <!-- col.// -->
		</div> <!-- row.// -->


	</div> <!-- container .//  -->
</section>
<!-- ========================= SECTION CONTENT END// ========================= -->


{% endblock content %}